<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tufted Rug Pricing Calculator</title>
    <style>
        /* ... existing CSS unchanged ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>üßµ Tufted Rug Pricing Calculator</h1>

        <!-- SETTINGS PANEL -->
        <div class="settings-section">
            <h2>‚öôÔ∏è Settings</h2>
            <!-- settings inputs as before -->
        </div>

        <!-- ORDER INPUTS -->
        <div class="input-section">
            <!-- order inputs as before -->
        </div>
        <button class="calculate-btn" onclick="calculatePrice()">Calculate & Log Quote</button>

        <!-- RESULTS -->
        <div class="results-section" id="results" style="display:none;">
            <!-- results display as before -->
        </div>
    </div>

    <script>
        // DEFAULT SETTINGS and load/save functions (unchanged)

        async function calculatePrice() {
            // ... calculation logic unchanged ...
            const quoteData = {
                timestamp: new Date().toISOString(),
                size: `${length}√ó${width}`,
                complexity,
                pile: pileType,
                experience,
                rush: rushOrder,
                materials: Math.round(baseMat),
                overhead: Math.round(withOH - baseMat),
                labor: Math.round(labor),
                profit: Math.round(profit),
                finalPrice: Math.round(final)
            };

            // 1) Display results
            displayResults(quoteData);

            // 2) Send to Google Sheets
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxJRHqOpNS0BzdzLtobauCEmZbW80-s82tG571dz-yLbEnhIHRVq8_ckpvNU5jCxZnh/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(quoteData)
                });
                console.log('Logged to Sheets');
            } catch (err) {
                console.error('Error logging to Sheets', err);
            }
        }

        function displayResults(data) {
            document.getElementById('results').style.display='block';
            document.getElementById('baseMaterials').textContent=`KSh ${data.materials.toLocaleString()}`;
            document.getElementById('withOverhead').textContent=`KSh ${data.overhead.toLocaleString()}`;
            document.getElementById('laborCost').textContent=`KSh ${data.labor.toLocaleString()}`;
            document.getElementById('profit').textContent=`KSh ${data.profit.toLocaleString()}`;
            document.getElementById('finalPrice').textContent=`KSh ${data.finalPrice.toLocaleString()}`;
            // detailed breakdown updated similarly...
        }
    </script>
</body>
</html>
